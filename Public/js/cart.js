$(document).ready(function() {    $(".deleteItem").live('click', function() {        var itemId = $(this).attr("itemId");        var productName = $(this).attr("productName");        var itemImage = $(this).attr("itemImage");        var itemFromMshop = $(this).attr("itemFromMshop");        var price = $(this).attr("price");        var currentItemCount = getItemCount(itemId);        deleteItemFromCart(itemId);        deleteFreeProductIfExist(itemId, currentItemCount);        removeShopcarNotifyEmar(itemId, productName, itemImage, itemFromMshop, price)    });    $(".add").live('click', function() {        var itemCount = eval($(".add").parents().find(".inputBorder").attr("value"));        itemCount = itemCount + 1;        $(".add").parents().find(".inputBorder").first().attr("value", itemCount)    });    $(".minus").live('click', function() {        var itemCount = eval($(".minus").parents().find(".inputBorder").attr("value"));        if (itemCount <= 1) return;        itemCount = itemCount - 1;        $(".minus").parents().find(".inputBorder").first().attr("value", itemCount)    });    var c;    $("#shopCartBox").hover(function() {        $(".shopCart").addClass("shopCart_on");        var tc = new TonysfarmCookie("/");        var scc = tc.getShoppingCartCount();        if (scc >= 1) displayCart();        else {            var noProdText = '<div class="nopro" id="nopro">您的购物车里还没有商品哦~ </br> 赶紧去选购吧！<\/div>';            $("#shopCartList").html(noProdText);            $("#shopCartList").css("display", "block");            $('#carts').html("0")        }    }, function() {        $(".shopCart").removeClass("shopCart_on");        c = setTimeout(function() {            $("#shopCartList").hide(0);            $('#shopCartList_iframe').hide()        }, 200)    });    $("#shopCartList").mouseover(function() {        clearTimeout(c)    });    $("#shopCartList").mouseout(function() {        c = setTimeout(function() {            $("#shopCartList").hide(0);            $('#shopCartList_iframe').hide()        }, 200)    });    (function() {        var tc = new TonysfarmCookie('http://www.tonysfarm.com');        var sc = getShoppingCartCount();        $('#carts').html(sc);        $('#cartIndexRight').html(sc)    })()});function displayCart() {    $(this).find("#shopCartList").show();    var cartUrl = "other/.com/cart/loadByStream.htm";    $.ajax({        method: "POST",        url: cartUrl,        dataType: "JSONP",        jsonp: "callBack",        cache: false,        success: function(data) {            loadcart(data[0])        }    })}function setpos() {    setTimeout(function() {        $("#shopCartList").show(0)    }, 200)}function loadcart(data) {    if (data.productList == null || data.productList.length == 0) {        $("#shopCartList").hide();        $('#shopCartList_iframe').hide();        $("#shopCartList").html("");        $('#carts').html("0");        $('#cartIndexRight').html(0);        return    }    var itemText = '<div class="shopList"><ul>';    $.each(data.productList, function(n, item) {        if (item.state == "off") {            deleteItemFromCart(item.id)        } else {            itemText += '<li id="cartItem_' + item.id + '" org_price_' + item.id + '="' + item.price + '">';            if (item.picUrl == "") {                itemText += '<div class="part1"><img src="images/card_smal1.jpg" \/><\/div>'            } else {                var picurl = item.image;                itemText += '<div class="part1"><img src="' + picurl + '" \/><\/div>'            }            itemText += '<div class="part2">';            itemText += '<p class="name"><a href="#">' + item.productName + '<\/a><\/p>';            itemText += '<p class="total"><i>¥<\/i><span class="price">' + item.price + '<\/span> X <span class="num">' + item.number + '<\/span><\/p>';            itemText += '<\/div>';            if (item.isFree == 1) {                itemText += '<div class="part3"><\/div>'            } else {                itemText += '<div class="part3"><a href="#" class="deleteItem" itemFromMshop="' + item.itemFromMshop + '" itemId="' + item.id + '" itemImage="' + item.image + '" productName="' + item.productName + '" price="' + item.price + '">删除<\/a><\/div>'            }            itemText += '<\/li>'        }    });    var shoppingCartTotalCount = getShoppingCartCount();    var totalPrice = getShoppingCartPrice();    itemText += '<\/ul><\/div>';    itemText += '<div class="totalHj">共计<span id="cartTotalCount" >' + shoppingCartTotalCount + '</span>件商品 共计<i>¥<\/i><span id="cartTotalPrice" class="totalPrice">' + totalPrice + '<\/span><\/div>';    itemText += '<div class="deal clearfix">';    itemText += '<div class="discount"><\/div>';    itemText += ' <a class="toBalance" href="\/order\/shopcart.html"><\/a>';    itemText += '<\/div>';    itemText += '<\/div>';    $("#shopCartList").html(itemText);    $('#carts').html(shoppingCartTotalCount);    $('#cartIndexRight').html(shoppingCartTotalCount);    setpos()}function getQuantityPriceRange(productId, quantity) {    var price;    $.ajax({        url: 'other/.com/cart/loadQuantityPriceRange.htm',        type: 'post',        data: 'productId=' + productId + '&quantity=' + quantity,        async: false,        success: function(data) {            price = data        }    });    return price}function deleteItemFromCart(itemId) {    var tc = new TonysfarmCookie("/");    var a = tc.getShoppingCartContent();    var nc = "";    var items = a.split("~");    for (var i = 0; i < items.length; i++) {        var b = items[i].split(",");        if (b[0] == itemId) {            continue        } else {            if (nc == "") nc = items[i];            else nc = nc + "~" + items[i]        }    }    writeShoppingCartCookie(nc);    $("#cartItem_" + itemId).hide(0);    var count = getShoppingCartCount();    writeShoppingCartCookieCount(count);    $('#carts').html(count);    $('#cartTotalCount').html(count);    $('#shoppingCartTotalCount').html(count);    $('#cartIndexRight').html(count);    var totalPrice = getShoppingCartPrice();    $('#cartTotalPrice').html(totalPrice);    if (count == 0) {        $("#shopCartList").html("");        $("#shopCartList").hide(0);        $('#shopCartList_iframe').hide()    }}function writeShoppingCartCookie(content) {    var validMin = 90 * 24 * 60;    TonysfarmCookie.writeCookie(TonysfarmCookie.SC, content, TM.COOKIE_DOMAIN, '/', validMin)}function writeOnekeybuyCookie(content) {    var validMin = 90 * 24 * 60;    TonysfarmCookie.writeCookie(TonysfarmCookie.SF, content, TM.COOKIE_DOMAIN, '/', validMin)}function writeShoppingCartCookieCount(count) {    var validMin = 90 * 24 * 60;    TonysfarmCookie.writeCookie(TonysfarmCookie.SD, count, TM.COOKIE_DOMAIN, '/', validMin)}function getProductIdList() {    var p = new Array();    var tc = new TonysfarmCookie("/");    var a = tc.getShoppingCartContent();    if (a == "" || a == "undefined") return p;    var items = a.split("~");    for (var i = 0; i < items.length; i++) {        var b = items[i].split(",");        p[i] = b[0]    }    return p}function getShoppingCartCount() {    var tc = new TonysfarmCookie("/");    var a = tc.getShoppingCartContent();    if (a == "" || a == "undefined") return 0;    var items = a.split("~");    var itemCount = 0;    for (var i = 0; i < items.length; i++) {        var b = items[i].split(",");        itemCount += parseInt(b[1])    }    return itemCount}function getShoppingCartPrice() {    var tc = new TonysfarmCookie("/");    var a = tc.getShoppingCartContent();    if (a == "") return 0;    var items = a.split("~");    var price = 0;    for (var i = 0; i < items.length; i++) {        var b = items[i].split(",");        price += b[1] * b[2]    }    return price}function getItemCount(itemId) {    var tc = new TonysfarmCookie("/");    var a = tc.getShoppingCartContent();    if (a == "" || a == "undefined") return 0;    var items = a.split("~");    var itemCount = 0;    for (var i = 0; i < items.length; i++) {        var b = items[i].split(",");        if (itemId == b[0]) return parseInt(b[1])    }    return 0}function setItemCount(itemId, count) {    var tc = new TonysfarmCookie("/");    var a = tc.getShoppingCartContent();    var nc = "";    var items = a.split("~");    for (var i = 0; i < items.length; i++) {        var b = items[i].split(",");        if (b[0] == itemId) {            b[1] = count;            var org_pric = $("#cartItem_" + itemId).attr("org_price_" + itemId);            price_html = '<span class="pro_price">¥' + org_pric + '</span>';            $("#cartItem_" + itemId).find("span").html(price_html);            var ni = "";            for (j = 0; j < b.length; j++) {                if (ni == "") ni = b[j];                else ni = ni + "," + b[j]            }            if (nc == "") nc = ni;            else nc = nc + "~" + ni        } else {            if (nc == "") nc = items[i];            else nc = nc + "~" + items[i]        }    }    writeShoppingCartCookie(nc);    $("#shoppingCartTotalCount").html(getShoppingCartCount());    $("#shoppingCartTotalPrice").html(getShoppingCartPrice())}function getItem(itemId, itemPrice, itemCount, date) {    return "" + itemId + "," + itemCount + "," + itemPrice + "," + date}function addOnekeybuyItem(itemId, itemPrice, itemCount) {    var d = new Date().getTime();    var nc = getItem(itemId, itemPrice, itemCount, d);    writeOnekeybuyCookie(nc)}function addShoppingCarItem(itemId, itemPrice, itemCount) {    var d = new Date().getTime();    var tc = new TonysfarmCookie("/");    var a = tc.getShoppingCartContent();    var nc = "";    var scc = parseInt(tc.getShoppingCartCount());    var added = false;    if (a == "undefined") {        scc += parseInt(itemCount);        nc = getItem(itemId, itemPrice, itemCount, d);        writeShoppingCartCookie(nc);        writeShoppingCartCookieCount(scc);        return    }    var items = a.split("~");    for (var i = 0; i < items.length; i++) {        var b = items[i].split(",");        if (b[0] == itemId) {            added = true;            var count = eval(b[1]) + eval(itemCount);            if (count <= 0) continue;            b[1] = count;            var ni = "";            for (j = 0; j < b.length; j++) {                if (ni == "") ni = b[j];                else ni = ni + "," + b[j]            }            if (nc == "") nc = ni;            else nc = nc + "~" + ni        } else {            if (nc == "") nc = items[i];            else nc = nc + "~" + items[i]        }    }    if (!added) {        scc += parseInt(itemCount);        var ni = getItem(itemId, itemPrice, itemCount, d);        if (nc == "") nc = ni;        else nc = nc + "~" + ni    } else {        nc = "";        for (var i = 0; i < items.length; i++) {            var b = items[i].split(",");            var pid = b[0];            if (pid == itemId) {                var count = eval(b[1]) + eval(itemCount);                if (count <= 0) continue;                b[1] = count;                var ni = "";                for (j = 0; j < b.length; j++) {                    if (ni == "") ni = b[j];                    else ni = ni + "," + b[j]                }                if (nc == "") nc = ni;                else nc = nc + "~" + ni            } else {                if (nc == "") nc = items[i];                else nc = nc + "~" + items[i]            }        }    }    writeShoppingCartCookie(nc);    writeShoppingCartCookieCount(scc)}function batchAddCart(t) {    $(t).parent().find("input[id*='tonysfarm_product']").each(function() {        var pId = $(this).attr("id");        var value = parseInt($(this).val());        var productId = pId.substring(17, pId.length);        if (value > 0) {            var product = queryProduct(productId, value);            addShoppingCarItem(productId, product.displayProductPromotionPrice, value)        }    });    var count = getShoppingCartCount();    $('#carts').html(count);    $('#cartIndexRight').html(count)}function addCart(pId) {    var value = $("#tonysfarm_product" + pId).val();    if (!value) {        value = "1"    }    if (!valInt(value)) {        $("#tonysfarm_product" + pId).val(1);        alert("请您输入数字！");        return    }    if (parseInt(value) == 0) {        $("#tonysfarm_product" + pId).val(1);        value = $("#tonysfarm_product" + pId).val()    }    var product = queryProduct(pId, value);    if (product.isPresale == 1) {        addOnekeybuyItem(pId, product.productPromotionPrice, value);        if (check_login()) {            window.location.href = "other/.com/order/orderconfirm-presale.html";            return        } else {            window.location.href = "other/.com/login.html";            return        }        return    } else if (product.deliverByVendor == 1) {        addOnekeybuyItem(pId, product.productPromotionPrice, value);        if (check_login()) {            window.location.href = "other/.com/order/orderconfirm-onekeybuy.html";            return        } else {            window.location.href = "other/.com/login.html";            return        }        return    }    addShoppingCarItem(pId, product.displayProductPromotionPrice, value);    var tc = new TonysfarmCookie("/");    var count = getShoppingCartCount();    $('#carts').html(count);    $('#shoppingCartTotalCount').html(count);    $('#cartIndexRight').html(count);    if (product.isFree == "false") {        addFreeProductIfExist(pId)    }}function addFreeProductIfExist(pId) {    var queryFreeProductUrl = "other/.com/cart/queryFreeProduct.htm?productId=" + pId;    $.ajax({        method: "POST",        url: queryFreeProductUrl,        dataType: "JSON",        cache: false,        async: false,        success: function(data) {            var freeProductId = data.freeProductId;            if (freeProductId != 0) {                addCart(freeProductId)            }        }    })}function valInt(value) {    return /^\d+$/.test(value)}function onchangProductNumber(pId, t, amount) {    var $parent = $(t).parent(".list_rt");    var $num = window.Number($parent.find("input").val());    if ($num == 0) {        deleteItemFromCart(pId)    } else {}}function productNumberPlus(pId, t, amount) {    var $parent = $(t).parent(".list_rt");    var $num = window.Number($parent.find("input").val());    $parent.find("input").val($num + 1);    var newNumber = window.Number($parent.find("input").val());    if (newNumber == 0) {        $parent.find("input").val($num + 1);        var newNumber = window.Number($parent.find("input").val());        $parent.find(".delete").removeClass("minus_disable").addClass("minus")    } else {        $parent.find(".delete").removeClass("minus_disable").addClass("minus")    }}function productNumberDelete(pId, t, amount) {    var $parent = $(t).parent(".list_rt");    var $num = window.Number($parent.find("input").val());    $parent.find("input").val($num - 1);    $num = window.Number($parent.find("input").val());    if ($num <= 0) {        $parent.find(".delete").removeClass("minus").addClass("minus_disable");        $parent.find("input").val(0)    } else {}    var tc = new TonysfarmCookie("/")}function queryProduct(productId, number) {    var product;    $.ajax({        url: base_path+'./index.php/Cart/addCart',        type: 'post',        data: 'productId=' + productId + "&number=" + number,        async: false,        dataType: "json",        success: function(data) {            if (data.result == "0000") {                product = data.cmsProduct            } else {                alert("找不到该产品相关信息!")            }        }    });    return product}function readytoadd(itemimage, alias, itemprice, skuid) {    var quantity = $("#tonysfarm_product" + skuid).val();    $("#cart_tip_img").html("<img src='" + itemimage + "'>");    $("#cart_tip_name").html(alias + "<br><span>X " + quantity + " 加入成功</span>");    $("#cart_tip_price").html("¥" + itemprice);    if (!$(".pop_cart").is(":animated")) {        $(".pop_cart").animate({            right: "56px",            top: "260px"        }, 220).show(function() {            setTimeout(function() {                $(".pop_cart").hide()            }, 2000)        })    }    addCart(skuid);    var _page_detail_product_code = $("#_page_detail_product_code").attr("value");    if (_page_detail_product_code) {        addShopcarNotifyEmarDetail()    } else {        addShopcarNotifyEmarNocate(itemimage, alias, itemprice, skuid)    }}function deleteFreeProductIfExist(pId, currentItemCount) {    var queryFreeProductUrl = "other/.com/cart/queryFreeProduct.htm?productId=" + pId;    $.ajax({        method: "POST",        url: queryFreeProductUrl,        dataType: "JSON",        cache: false,        async: false,        success: function(data) {            var freeProductId = data.freeProductId;            if (freeProductId != 0) {                var freeItemCount = getItemCount(freeProductId);                var c = freeItemCount - currentItemCount;                if (c <= 0) {                    deleteItemFromCart(freeProductId);                    $("#product" + freeProductId).hide(0)                } else {                    setItemCount(freeProductId, c)                }            }        }    })}function addChouGanToCart() {    addShoppingCarItem(3694, 0, 1)}function addShopcarNotifyEmarDetail() {    var itemImage = $("#_page_detail_product_image").attr("value");    var itemPrice = $("#_page_detail_product_price").attr("value");    var itemName = $("#_page_detail_product_name").attr("value");    var skuId = $("#_page_detail_item_skuid").attr("value");    var categoryName = $("#_page_detail_product_category_name").attr("value");    var itemId = $("#_page_detail_product_code").attr("value");    addShopcarNotifyEmar(itemImage, itemPrice, itemName, skuId, categoryName, itemId)}function addShopcarNotifyEmarNocate(itemImage, alias, itemPrice, skuId) {    var itemName = alias;    var categoryName = '';    var itemId = '';    addShopcarNotifyEmar(itemImage, itemPrice, itemName, skuId, categoryName, itemId)}function addShopcarNotifyEmar(itemImage, itemPrice, itemName, skuId, categoryName, itemId) {}function removeShopcarNotifyEmar(itemId, productName, itemImage, itemFromMshop, price) {}